{% assign stations = resultado | sort_natural: 'Preco' | slice: 0, 10 %}

<div style="font-family: monospace; padding: 10px;">
  <div style="text-align: center; font-size: 22px; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid black; padding-bottom: 8px;">
    ‚õΩ PRE√áOS GASOLINA 95 - VILA FRANCA DE XIRA
  </div>

  <div style="font-size: 12px; margin-bottom: 10px;">
    Fonte dos dados: {{ status }}
  </div>

  {% if stations.size > 0 %}
    <div style="font-size: 11px; margin-bottom: 5px;">
      <strong>Top 10 Mais Baratos</strong> (atualizado: {{ "now" | date: "%d/%m/%Y %H:%M" }})
    </div>
    
    <table style="width: 100%; font-size: 10px; border-collapse: collapse;">
      <thead>
        <tr style="border-bottom: 1px solid black;">
          <th style="text-align: left; padding: 4px;">#</th>
          <th style="text-align: left; padding: 4px;">POSTO</th>
          <th style="text-align: left; padding: 4px;">MARCA</th>
          <th style="text-align: left; padding: 4px;">LOCALIDADE</th>
          <th style="text-align: right; padding: 4px;">PRE√áO</th>
          <th style="text-align: center; padding: 4px;">ATUALIZADO</th>
        </tr>
      </thead>
      <tbody>
        {% for station in stations %}
          <tr style="border-bottom: 1px solid #ddd;">
            <td style="padding: 4px;">{{ forloop.index }}</td>
            <td style="padding: 4px;">{{ station.Nome | truncate: 40 }}</td>
            <td style="padding: 4px;">{{ station.Marca | truncate: 12 }}</td>
            <td style="padding: 4px;">{{ station.Localidade | truncate: 30 }}</td>
            <td style="padding: 4px; text-align: right; font-weight: bold;">{{ station.Preco }}</td>
            <td style="padding: 4px; text-align: center; font-size: 9px;">{{ station.DataAtualizacao | slice: 5, 5 }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
    
    {% assign cheapest = stations | first %}
    {% assign most_expensive = resultado | sort_natural: 'Preco' | last %}
    {% assign price_cheapest = cheapest.Preco | remove: '‚Ç¨' | strip | replace: ',', '.' | times: 1 %}
    {% assign price_expensive = most_expensive.Preco | remove: '‚Ç¨' | strip | replace: ',', '.' | times: 1 %}
    {% assign diff = price_expensive | minus: price_cheapest %}
    
    <div style="margin-top: 10px; padding: 8px; background: #f0f0f0; font-size: 10px;">
      <strong>üí∞ Poupan√ßa m√°xima:</strong> {{ diff | round: 3 }}‚Ç¨/litro ({{ cheapest.Marca }} vs {{ most_expensive.Marca }})
    </div>
    
  {% else %}
    <div style="text-align: center; padding: 40px; font-size: 14px;">
      ‚ö†Ô∏è Erro ao carregar dados da API<br>
      <div style="font-size: 10px; margin-top: 10px;">
        Debug: markup size = {{ markup.size }}<br>
        status = {{ markup.status }}<br>
        resultado size = {{ markup.resultado.size }}
      </div>
    </div>
  {% endif %}
</div>
